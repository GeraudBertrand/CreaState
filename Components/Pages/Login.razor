@page "/"
@layout LoginLayout

@inject NavigationManager NavManager

<PageTitle>Connexion - Créalab</PageTitle>

<div class="login-wrapper theme-industrial">
    <div class="login-card animate-fade-in">
        <div class="login-header">
            <i class="fa-solid fa-layer-group fa-3x"></i>
            <h2>Créalab ESILV</h2>
            <p>Portail de connexion au Fablab.</p>
        </div>

        <div class="login-form">
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="error-alert">
                    <i class="fa-solid fa-triangle-exclamation"></i> @ErrorMessage
                </div>
            }
            <div class="flex-row d-flex justify-content-around">
                <div class="form-group">
                    <label for="username">Identifiant</label>
                    <input type="text" id="username" class="form-control" @bind="Username" placeholder="Ex: admin ou membre" />
                </div>

                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" class="form-control" @bind="Password" @onkeyup="HandleKeyUp" placeholder="••••••••" />
                </div>
            </div>
            

            <button class="btn-primary" @onclick="AttemptLogin">
                Se connecter
            </button>

            <button class="btn-secondary" @onclick="GoToPublic">
                Accès Visiteur (Site Public)
            </button>
        </div>

        <div class="login-footer">
            <p>Comptes de test : <strong>admin</strong>/1234 ou <strong>membre</strong>/1234</p>
            <p class="help-text">Besoin d'un accès ? Demandez au responsable partenariat.</p>
        </div>
    </div>
</div>

@code {
    private string Username { get; set; } = "";
    private string Password { get; set; } = "";
    private string ErrorMessage { get; set; } = "";

    private void AttemptLogin()
    {
        ErrorMessage = "";

        // --- SIMULATION DE VÉRIFICATION ---
        if (Username.ToLower() == "admin" && Password == "1234")
        {
            NavManager.NavigateTo("/printers");
        }
        else if (Username.ToLower() == "membre" && Password == "1234")
        {
            NavManager.NavigateTo("/public");
        }
        else if (string.IsNullOrWhiteSpace(Username) || string.IsNullOrWhiteSpace(Password))
        {
            ErrorMessage = "Veuillez remplir tous les champs.";
        }
        else
        {
            ErrorMessage = "Identifiant ou mot de passe incorrect.";
        }
    }

    private void GoToPublic()
    {
        NavManager.NavigateTo("/public");
    }

    private void HandleKeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            AttemptLogin();
        }
    }
}